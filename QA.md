## Q

Run set -ex
+ export TARGET=aarch64-linux-android
+ TARGET=aarch64-linux-android
+ export API=24
+ API=24
+ export CC=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang
+ CC=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang
+ export CXX=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang++
+ CXX=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang++
+ export AR=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar
+ AR=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar
+ export LD=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/ld
+ LD=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/ld
+ export STRIP=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip
+ STRIP=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip
+ export CFLAGS=--sysroot=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/sysroot
+ CFLAGS=--sysroot=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/sysroot
+ export LDFLAGS=--sysroot=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/sysroot
+ LDFLAGS=--sysroot=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/sysroot
++ pwd
+ BUILD_ROOT=/home/runner/work/android-wheels/android-wheels/library-source
+ cd library-source
++ find . -name pyproject.toml -o -name setup.py
++ head -n 1
+ PROJECT_FILE=./crates/jiter-python/pyproject.toml
+ '[' -n ./crates/jiter-python/pyproject.toml ']'
++ dirname ./crates/jiter-python/pyproject.toml
+ PROJECT_DIR=./crates/jiter-python
+ cd ./crates/jiter-python
+ IS_MATURIN=false
+ '[' -f pyproject.toml ']'
+ grep -q 'build-backend.*=.*"maturin"' pyproject.toml
+ IS_MATURIN=true
+ '[' true = true ']'
+ echo 'Maturin build backend detected.'
+ rustup target add aarch64-linux-android
Maturin build backend detected.
info: downloading component 'rust-std' for 'aarch64-linux-android'
info: installing component 'rust-std' for 'aarch64-linux-android'
++ echo aarch64-linux-android
++ tr a-z- A-Z_
+ TARGET_FOR_ENV=AARCH64_LINUX_ANDROID
+ export CARGO_TARGET_AARCH64_LINUX_ANDROID_LINKER=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang
+ CARGO_TARGET_AARCH64_LINUX_ANDROID_LINKER=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang
+ export CARGO_TARGET_AARCH64_LINUX_ANDROID_AR=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar
+ CARGO_TARGET_AARCH64_LINUX_ANDROID_AR=/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-ar
+ FEATURES=
+ '[' -f Cargo.toml ']'
+ grep -q '^pyo3 ' Cargo.toml
+ echo 'Direct pyo3 dependency found. Adding '\''extension-module'\'' feature.'
+ FEATURES=pyo3/extension-module
Direct pyo3 dependency found. Adding 'extension-module' feature.
+ '[' -n pyo3/extension-module ']'
+ maturin build --release --target aarch64-linux-android -i python3.13 --features pyo3/extension-module
    Updating crates.io index
     Locking 118 packages to latest compatible versions
      Adding codspeed-criterion-compat v2.10.1 (available: v4.0.4)
      Adding pyo3 v0.26.0 (available: v0.27.0)
      Adding pyo3-build-config v0.26.0 (available: v0.27.0)
 Downloading crates ...
  Downloaded crossbeam-deque v0.8.6
  Downloaded ahash v0.8.12
  Downloaded version_check v0.9.5
  Downloaded target-lexicon v0.13.3
  Downloaded unindent v0.2.4
  Downloaded plotters-svg v0.3.7
  Downloaded radium v0.7.0
  Downloaded wyz v0.5.1
  Downloaded shlex v1.3.0
  Downloaded tap v1.0.1
  Downloaded walkdir v2.5.0
  Downloaded unicode-ident v1.0.19
  Downloaded uuid v1.18.1
  Downloaded serde_derive v1.0.228
  Downloaded zerocopy-derive v0.8.27
  Downloaded lexical-util v1.0.7
  Downloaded libfuzzer-sys v0.4.10
  Downloaded serde_json v1.0.145
  Downloaded regex v1.12.2
  Downloaded zerocopy v0.8.27
  Downloaded lexical-parse-float v1.0.6
  Downloaded aho-corasick v1.1.3
  Downloaded clap_builder v4.5.49
  Downloaded bitvec v1.0.1
  Downloaded rayon v1.11.0
  Downloaded syn v2.0.107
  Downloaded plotters v0.3.7
  Downloaded hashbrown v0.16.0
  Downloaded codspeed-criterion-compat-walltime v2.10.1
  Downloaded regex-syntax v0.8.8
  Downloaded itertools v0.10.5
  Downloaded indexmap v2.12.0
  Downloaded cc v1.2.41
  Downloaded pyo3-macros-backend v0.26.0
  Downloaded pyo3-ffi v0.26.0
  Downloaded memchr v2.7.6
  Downloaded serde v1.0.228
  Downloaded rayon-core v1.13.0
  Downloaded num-traits v0.2.19
  Downloaded half v2.7.1
  Downloaded clap v4.5.49
  Downloaded regex-automata v0.4.13
  Downloaded serde_core v1.0.228
  Downloaded ryu v1.0.20
  Downloaded num-bigint v0.4.6
  Downloaded getrandom v0.3.4
  Downloaded crossbeam-epoch v0.9.18
  Downloaded smallvec v1.15.1
  Downloaded quote v1.0.41
  Downloaded proc-macro2 v1.0.101
  Downloaded paste v1.0.15
  Downloaded libc v0.2.177
  Downloaded once_cell v1.21.3
  Downloaded find-msvc-tools v0.1.4
  Downloaded crossbeam-utils v0.8.21
  Downloaded tinytemplate v1.2.1
  Downloaded same-file v1.0.6
  Downloaded pyo3-build-config v0.26.0
  Downloaded lexical-parse-integer v1.0.6
  Downloaded jobserver v0.1.34
  Downloaded colored v2.2.0
  Downloaded ciborium v0.2.2
  Downloaded cfg-if v1.0.4
  Downloaded arbitrary v1.4.2
  Downloaded pyo3-macros v0.26.0
  Downloaded plotters-backend v0.3.7
  Downloaded oorandom v11.1.5
  Downloaded num-integer v0.1.46
  Downloaded heck v0.5.0
  Downloaded criterion-plot v0.5.0
  Downloaded pyo3 v0.26.0
  Downloaded ciborium-ll v0.2.2
  Downloaded anes v0.1.6
  Downloaded memoffset v0.9.1
  Downloaded itoa v1.0.15
  Downloaded lazy_static v1.5.0
  Downloaded is-terminal v0.4.16
  Downloaded autocfg v1.5.0
  Downloaded anstyle v1.0.13
  Downloaded indoc v2.0.6
  Downloaded funty v2.0.0
  Downloaded either v1.15.0
  Downloaded codspeed-criterion-compat v2.10.1
  Downloaded codspeed v2.10.1
  Downloaded clap_lex v0.7.6
  Downloaded cast v0.3.0
  Downloaded ciborium-io v0.2.2
  Downloaded equivalent v1.0.2
üîó Found pyo3 bindings
üêç Found CPython 3.13
üì° Using build options bindings from pyproject.toml
   Compiling target-lexicon v0.13.3
   Compiling autocfg v1.5.0
   Compiling proc-macro2 v1.0.101
   Compiling libc v0.2.177
   Compiling quote v1.0.41
   Compiling unicode-ident v1.0.19
   Compiling num-traits v0.2.19
   Compiling pyo3-build-config v0.26.0
   Compiling pyo3-macros-backend v0.26.0
   Compiling pyo3-ffi v0.26.0
   Compiling syn v2.0.107
   Compiling memoffset v0.9.1
   Compiling getrandom v0.3.4
   Compiling zerocopy v0.8.27
   Compiling heck v0.5.0
   Compiling version_check v0.9.5
   Compiling radium v0.7.0
   Compiling ahash v0.8.12
   Compiling pyo3 v0.26.0
   Compiling num-integer v0.1.46
   Compiling lexical-util v1.0.7
   Compiling once_cell v1.21.3
   Compiling tap v1.0.1
   Compiling cfg-if v1.0.4
   Compiling wyz v0.5.1
   Compiling num-bigint v0.4.6
   Compiling lexical-parse-integer v1.0.6
   Compiling jiter v0.11.1 (/home/runner/work/android-wheels/android-wheels/library-source/crates/jiter)
   Compiling funty v2.0.0
   Compiling unindent v0.2.4
   Compiling indoc v2.0.6
   Compiling bitvec v1.0.1
   Compiling lexical-parse-float v1.0.6
   Compiling smallvec v1.15.1
   Compiling pyo3-macros v0.26.0
   Compiling jiter-python v0.11.1 (/home/runner/work/android-wheels/android-wheels/library-source/crates/jiter-python)
error: linking with `/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang` failed: exit status: 1
  |
  = note:  "/home/runner/work/_temp/android-ndk/android-ndk-r26d/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android24-clang" "-Wl,--version-script=/tmp/rustcw29VsE/list" "-Wl,--no-undefined-version" "/tmp/rustcw29VsE/symbols.o" "<5 object files omitted>" "-Wl,--as-needed" "-Wl,-Bstatic" "/home/runner/work/android-wheels/android-wheels/library-source/target/aarch64-linux-android/release/deps/{libjiter-66582c9d85f82d26,libbitvec-e4c407e2a386ea1f,libwyz-f424f23bc67c0cd5,libtap-4ec44f0fb417be28,libradium-935b449bf3d0536f,libfunty-a752805c0f1bfaf3,libsmallvec-89119d18ee71f646,libahash-e59362d85b0ed027,libgetrandom-1e5ece86acbc894c,libcfg_if-7e2a473a014abeb7,libzerocopy-df2c69ea3a7a759b,liblexical_parse_float-6096ba0b8e478559,liblexical_parse_integer-0ab6b68c98ab280a,liblexical_util-ae577773652de171,libpyo3-5de12c82055fa24d,libonce_cell-851fe2ba938db894,libpyo3_ffi-ec514c4df22d5c3c,liblibc-a92b90510b13a3f9,libnum_bigint-180fb543da49a1f1,libnum_integer-0c349ecccba6aefa,libnum_traits-19c6dfc5d904a2e2,libmemoffset-2d7f3921fa40732f,libunindent-628026d7f6dc08fa}.rlib" "<sysroot>/lib/rustlib/aarch64-linux-android/lib/{libstd-*,libpanic_unwind-*,libobject-*,libmemchr-*,libaddr2line-*,libgimli-*,librustc_demangle-*,libstd_detect-*,libhashbrown-*,librustc_std_workspace_alloc-*,libminiz_oxide-*,libadler2-*,libunwind-*,libcfg_if-*,liblibc-*,librustc_std_workspace_core-*,liballoc-*,libcore-*,libcompiler_builtins-*}.rlib" "-Wl,-Bdynamic" "-lpython3.13" "-ldl" "-llog" "-lunwind" "-ldl" "-lm" "-lc" "-L" "/tmp/rustcw29VsE/raw-dylibs" "-Wl,--eh-frame-hdr" "-Wl,-z,noexecstack" "-o" "/home/runner/work/android-wheels/android-wheels/library-source/target/aarch64-linux-android/release/deps/libjiter_python.so" "-Wl,--gc-sections" "-shared" "-Wl,-z,relro,-z,now" "-Wl,-O1" "-Wl,--strip-debug" "-nodefaultlibs"
  = note: some arguments are omitted. use `--verbose` to show all linker arguments
  = note: ld.lld: error: unable to find library -lpython3.13
          clang-17: error: linker command failed with exit code 1 (use -v to see invocation)
          

error: could not compile `jiter-python` (lib) due to 1 previous error
üí• maturin failed
  Caused by: Failed to build a native library through cargo
  Caused by: Cargo build finished with "exit status: 101": `env -u CARGO PYO3_BUILD_EXTENSION_MODULE="1" PYO3_CONFIG_FILE="/home/runner/work/android-wheels/android-wheels/library-source/target/maturin/pyo3-config-aarch64-linux-android-3.13.txt" "cargo" "rustc" "--features" "pyo3/extension-module" "--target" "aarch64-linux-android" "--message-format" "json-render-diagnostics" "--manifest-path" "/home/runner/work/android-wheels/android-wheels/library-source/crates/jiter-python/Cargo.toml" "--release" "--lib" "--crate-type" "cdylib"`
Error: Process completed with exit code 1.


## A
ÊàëË¶ÅÂÖàÂú®Â∑•‰ΩúÂå∫ÈáåÊâæÂá∫Â∑•‰ΩúÊµÅÊñá‰ª∂ÂíåÊûÑÂª∫ËÑöÊú¨Ôºå‰ª•‰æøÂ§çÁé∞Âπ∂‰øÆÂ§çÈìæÊé•ÈîôËØØÔºà-lpython3.13 Êâæ‰∏çÂà∞ÔºâÔºåÈ¢ÑÊúüËÉΩÂÆö‰ΩçÂà∞ .github/workflows Âíå‰ªª‰ΩïËá™ÂÆö‰πâÁöÑ build ËÑöÊú¨ÂÜÖÂÆπ„ÄÇ 

ÊêúÁ¥¢‰∏é `**/*` ÂåπÈÖçÁöÑÊñá‰ª∂Ôºå20 ÂåπÈÖçÈ°π

ÊàëÂ∞ÜÊâìÂºÄÁõ∏ÂÖ≥ÁöÑÂ∑•‰ΩúÊµÅ YAML Êñá‰ª∂‰ª•‰∫ÜËß£ÂΩìÂâçÊûÑÂª∫Ê≠•È™§ÂíåÁéØÂ¢ÉËÆæÁΩÆÔºå‰ªéËÄåÂÆö‰Ωç‰∏∫‰ªÄ‰πàÂú® Android ‰∫§ÂèâÁºñËØëÊó∂Â∞ùËØïÈìæÊé•Âà∞ libpython3.13 Âπ∂‰øÆÂ§çÂÆÉ„ÄÇ 

ËØªÂèñ [](file:///Users/wuhao/my/Proj/android-wheels/.github/workflows/build-android-wheel.yml)

Â∑≤ËøêË°å `resolve-library-id`
Completed with input: {
  "libraryName": "pyo3"
}

‰∏∫‰∫ÜÂÄüÈâ¥Â∑≤Â≠òÂú®ÁöÑ Android Rust Êâ©Â±ïÂ∫ìÊûÑÂª∫ÊñπÂºèÔºåÊàë‰ºöÊâìÂºÄÂá†‰∏™Áõ∏‰ººÁöÑÂ∑•‰ΩúÊµÅÊñá‰ª∂ÔºàÂ¶Ç orjson„ÄÅrpds-py Á≠âÔºâÁúãÁúãÂÆÉ‰ª¨Â¶Ç‰ΩïÈÅøÂÖçÈìæÊé•Âà∞ libpython„ÄÇ 

ËØªÂèñ [](file:///Users/wuhao/my/Proj/android-wheels/.github/workflows/build-orjson-android.yml)

ËØªÂèñ [](file:///Users/wuhao/my/Proj/android-wheels/.github/workflows/build-jiter-android.yml)

ÊêúÁ¥¢ `PYO3_CROSS|Chaquopy|libpython|android-ndk|maturin build` (`**/*.yml`)„ÄÅ20 ÁªìÊûúÁöÑÊñáÊú¨

Â∑≤ÂàõÂª∫ 3 ‰∏™ÂæÖÂäû‰∫ãÈ°π

Ê≠£Âú®‰ΩøÁî® "Â∫îÁî®‰øÆË°•Á®ãÂ∫è"


```

```


Â∑≤Ê£ÄÊü• [](file:///Users/wuhao/my/Proj/android-wheels/.github/workflows/build-android-wheel.yml)ÔºåÂèëÁé∞ 8 ÈóÆÈ¢ò

Â∑≤ËøêË°å `get-library-docs`
Completed with input: {
  "context7CompatibleLibraryID": "/pyo3/pyo3",
  "topic": "cross compiling android abi3 maturin extension-module link libpython",
  "tokens": 4000
}

Ê≠£Âú®‰ΩøÁî® "Â∫îÁî®‰øÆË°•Á®ãÂ∫è"


```

```


Ê≠£Âú®ÂêØÂä®(3/3) *Verify impacts and document next steps*

Ê≠£Âú®‰ΩøÁî® "Â∫îÁî®‰øÆË°•Á®ãÂ∫è"


```

```
ÊàëÁúãÂà∞‰∫Ü‰Ω†ÁöÑ CI Êó•ÂøóÈáå Maturin/PyO3 Âú®‰∫§ÂèâÁºñËØë Android Êó∂Â∞ùËØïÈìæÊé• -lpython3.13 ÂØºËá¥ÈìæÊé•Â§±Ë¥•ÔºõÊàë‰ºöÊõ¥Êñ∞ÂèØÂ§çÁî®ÁöÑÊûÑÂª∫Â∑•‰ΩúÊµÅÔºåÈÅøÂÖçÂú® Android ÁõÆÊ†á‰∏äÈìæÊé•Âà∞ libpythonÔºåÂπ∂‰øùÁïôÊ≠£Á°ÆÁöÑ wheel tag„ÄÇ

## ÈááÂèñÁöÑ‰øÆÊîπ

- Âú® build-android-wheel.yml ÁöÑ maturin ÊûÑÂª∫ÂàÜÊîØÈáåÊñ∞Â¢û PyO3 Ë∑®ÁºñËØëÁéØÂ¢ÉÂèòÈáèÔºö
  - ËÆæÁΩÆ `PYO3_CROSS=1` Âíå `PYO3_CROSS_PYTHON_VERSION=${{ env.PYTHON_VERSION }}`ÔºåÈÅøÂÖç PyO3 ÂéªÊé¢ÊµãÂÆø‰∏ª PythonÔºå‰ªéËÄåËØØÂà§Âπ∂Ê∑ªÂä† `-lpython3.13`„ÄÇ
  - ÂΩìÂ∞ùËØï abi3 ÊûÑÂª∫Êó∂Ôºå‰∏¥Êó∂ËÆæÁΩÆ `PYO3_NO_PYTHON=1`ÔºåÂÆåÂÖ®ÈÅøÂÖçÊûÑÂª∫Êó∂Ë∞ÉÁî®ÂÆø‰∏ªËß£ÈáäÂô®„ÄÇ
- ÈíàÂØπÁõ¥Ëøû pyo3 ÁöÑ crateÔºö
  - ‰ºòÂÖàÂ∞ùËØïÂêØÁî® `pyo3/extension-module pyo3/abi3-py37`ÔºåÁîüÊàê abi3 Êâ©Â±ïÊ®°ÂùóÔºàÊó†ÈúÄÈìæÊé• libpythonÔºåÈÄÇÂêà AndroidÔºâ„ÄÇ
  - Â¶ÇÊûú abi3 ‰∏çË¢´ËØ•È°πÁõÆÊîØÊåÅÔºåÂàôËá™Âä®ÂõûÈÄÄ‰∏∫Âè™ÂêØÁî® `pyo3/extension-module` ÁªßÁª≠ÊûÑÂª∫„ÄÇ
- ÊîπËøõ wheel ÈáçÂëΩÂêçÈÄªËæëÔºö
  - ‰ªéÂ∑≤ÊûÑÂª∫ wheel ÁöÑÊñá‰ª∂Âêç‰∏≠Ëß£Êûê `python tag` Âíå `abi tag`Ôºà‰æãÂ¶Ç abi3ÔºâÔºåÁ°Æ‰øùÈáçÂëΩÂêçÂêé‰ªç‰øùÁïô abi3 Êàñ cpXX ÁöÑÁúüÂÆûÊ†áÁ≠æÔºå‰∏çÂÜçÂº∫Âà∂‰ΩøÁî® `cp{PY}-cp{PY}`„ÄÇ
- ‰ªç‰øùÁïôÂéüÊúâÁöÑ NDK/Clang ‰∫§ÂèâÁºñËØëÈÖçÁΩÆ‰∏éËæìÂá∫‰∫ßÁâ©‰∏ä‰º†ÈÄªËæë„ÄÇ

Ëøô‰∫õÊîπÂä®Â∑≤ÂÜôÂÖ•Ôºö
- build-android-wheel.ymlÔºàÊñ∞Â¢û PyO3 Ë∑®ÁºñËØëÂèòÈáè„ÄÅabi3 ‰ºòÂÖà+ÂõûÈÄÄÈÄªËæë„ÄÅwheel tag ‰øùÁïôÔºâ

ÁÆÄË¶ÅÂéüÂõ†Ôºö
- PyO3 Âú®‚ÄúÊâ©Â±ïÊ®°Âùó‚ÄùÊ®°Âºè‰∏ãÊú¨Â∞±‰∏çÈúÄË¶ÅÂú®Á±ª Unix Âπ≥Âè∞ÈìæÊé• libpythonÔºõ‰ΩÜ‰∫§ÂèâÁºñËØëÊó∂Ëã•Áî®ÂÆø‰∏ª Python Êé¢ÊµãÈÖçÁΩÆÔºåÂÆπÊòìËØØÂà§‰∏∫ÈúÄË¶Å `-lpythonX.Y`„ÄÇËÆæÁΩÆ `PYO3_CROSS`/`PYO3_NO_PYTHON` ‰∏é‰ΩøÁî® `abi3` ÂèØÈÅøÂÖçËØ•ÈóÆÈ¢ò„ÄÇ
- abi3 ËÉΩËÆ©Âêå‰∏Ä wheel ÂÖºÂÆπÂ§ö‰∏™ Python Â∞èÁâàÊú¨ÔºåÈùûÂ∏∏ÈÄÇÂêàÈ¢ÑÁºñËØëÂàÜÂèëÔºàÂåÖÊã¨ AndroidÔºâ„ÄÇ

## ÂΩ±Âìç‰∏éÈ™åËØÅ

- ÈíàÂØπ jiterÔºà`pydantic/jiter`ÔºâÔºö
  - Â∑≤Ëá™Âä®Ê£ÄÊµã `Cargo.toml` ‰∏ãÊòØÂê¶Áõ¥Ëøû‰æùËµñ `pyo3`ÔºåÂ¶ÇÊòØÂàôÂ∞ùËØï abi3ÔºõËã• jiter ‰∏çÊîØÊåÅ abi3Ôºå‰ºöËá™Âä®ÂõûÈÄÄ‰ΩÜ‰ªç‰∏çÈìæÊé• libpythonÔºàÂõ†‰∏∫ÂêØÁî®‰∫Ü cross Âπ∂‰∏î extension-moduleÔºâ„ÄÇ
- ÂØπÂÖ∂ÂÆÉ‰ΩøÁî®ËØ•ÂèØÂ§çÁî®Â∑•‰ΩúÊµÅÁöÑÂ∫ìÔºàorjson„ÄÅpydantic-core„ÄÅrpds-py„ÄÅzstandard Á≠âÔºâÂêåÊ†∑ÁîüÊïàÔºõ‰øùÁïôÂêÑËá™ wheel ÁöÑÊ≠£Á°Æ ABI tag„ÄÇ
- Â∑•‰ΩúÊµÅÈáåÁöÑ `${{ env.NDK_PATH }}` ÈÄöËøáÂâçÁΩÆÊ≠•È™§ÂÜôÂÖ• `GITHUB_ENV`ÔºåÂú® Actions ÁéØÂ¢É‰∏≠ÊúâÊïàÔºõÊú¨Âú∞ÈùôÊÄÅÊ£ÄÊü•ÊèêÁ§∫ÁöÑ‚ÄúÂèØËÉΩÊó†Êïà‚ÄùÊòØÁºñËæëÂô®/ÈùôÊÄÅÂàÜÊûêÁöÑËØØÊä•ÔºåËøêË°åÊó∂Êó†Á¢ç„ÄÇ

Ë¥®ÈáèÈó®Ôºö
- Build: N/AÔºàGitHub Actions ‰∏äÊâßË°åÔºâ
- Lint/Typecheck: PASSÔºàYAML ÁªìÊûÑ‰∏éËØ≠Ê≥ïÊúâÊïàÔºâ
- Tests: N/AÔºàÂ∑•‰ΩúÊµÅÂèòÊõ¥Ôºå‰∏çÂΩ±Âìç‰ªìÂ∫ì‰ª£Á†ÅÊâßË°åÔºâ

## ‰Ω†Êé•‰∏ãÊù•ÂèØ‰ª•ÂÅö‰ªÄ‰πà

- Áõ¥Êé•Âú®‰ªìÂ∫ìÁöÑ Actions È°µÈù¢ÊâãÂä®Ëß¶Âèë‚ÄúBuild jiter Android wheel for Chaquopy‚ÄùÂ∑•‰ΩúÊµÅÔºåÊàñÊé®ÈÄÅËß¶Âèë„ÄÇ
- Ëã•ÈúÄË¶ÅÊàëÁé∞Âú®Â∏Æ‰Ω†Âú®Êú¨Âú∞Ëß¶Âèë‰∏ÄÊ¨°ÂØπÂ∫î workflow_dispatchÔºåËØ∑ÂëäËØâÊàëË¶ÅÁî®ÁöÑÂèÇÊï∞Ôºàpython ÁâàÊú¨„ÄÅndk ÁâàÊú¨„ÄÅandroid api„ÄÅjiter ÁâàÊú¨Ôºâ„ÄÇÊàë‰πüÂèØ‰ª•ÂêåÊ≠•Ëß¶ÂèëÂÖ∂ÂÆÉÂ∫ìÁöÑÊûÑÂª∫‰ª•È™åËØÅ„ÄÇ

## Â§áÊ≥®‰∏éËæπÁïåÊÉÖÂÜµ

- Â¶ÇÊûúÊüê‰∏™ crate Êú¨Ë∫´‰ΩøÁî®‰∫Ü PyO3 ‰ΩÜ‰∏çÂÖºÂÆπ abi3ÔºåÊûÑÂª∫‰ºöËµ∞Âà∞ÂõûÈÄÄË∑ØÂæÑÔºö‰ªç‰∏∫ extension moduleÔºå‰∏îÁî±‰∫éÂêØÁî®‰∫ÜË∑®ÁºñËØëÂèòÈáèÔºå‰∏ç‰ºöÈìæÊé• libpython„ÄÇ
- ‰∏™Âà´È°πÁõÆËã•Âπ∂ÈùûÁõ¥Êé•Âú®ÂΩìÂâç crate ÁöÑ `Cargo.toml` ‰∏≠Â£∞Êòé `pyo3`ÔºàÊØîÂ¶ÇÁªßÊâøËá™ workspace ‰æùËµñÔºâÔºåÊàëÁöÑ‚ÄúÁõ¥Êé•‰æùËµñÊ£ÄÊµã‚ÄùÂèØËÉΩÊé¢Êµã‰∏çÂà∞Ôºå‰ΩÜÂ§öÊï∞È°πÁõÆÁöÑ maturin ÈÖçÁΩÆÊàñËá™Ë∫´ features Â∑≤ÂåÖÂê´ extension-moduleÔºõËã•‰Ω†ÈÅáÂà∞Êüê‰∏™ÁâπÊÆäÈ°πÁõÆ‰ªçÁÑ∂ËØïÂõæÈìæÊé• libpythonÔºåÊàëÂèØ‰ª•ÂÜçÊääÊ£ÄÊµãÈÄªËæëÊîæÂÆΩÂà∞ `grep -E '^[[:space:]]*pyo3[[:space:]]*='` ÊàñËß£Êûê `workspace.dependencies`„ÄÇ

## Â∞èÁªì

- ‰øÆÂ§çÁÇπÔºöÈÅøÂÖçÂú® Android ÁõÆÊ†á‰∏äÈìæÊé• `-lpython3.13`ÔºåÊîπ‰∏∫ abi3 ‰ºòÂÖà + Ë∑®ÁºñËØëÊ®°ÂºèÔºå‰∏î‰øùÁïôÊ≠£Á°Æ wheel Ê†áÁ≠æ„ÄÇ
- Â∑≤Êõ¥Êñ∞ build-android-wheel.yml Âπ∂Á®≥Â¶•Â§ÑÁêÜ‰∏çÊîØÊåÅ abi3 ÁöÑÂõûÈÄÄË∑ØÂæÑ„ÄÇ
- Âª∫ËÆÆÁé∞Âú®ÈáçÊñ∞Ë∑ë jiter ÁöÑ Android ÊûÑÂª∫È™åËØÅ„ÄÇÈúÄË¶ÅÊàë‰ª£‰∏∫Ëß¶Âèë‰πüÂèØ‰ª•ÂëäËØâÊàëÂèÇÊï∞„ÄÇ

Â∑≤ËøõË°åÊõ¥Êîπ„ÄÇ


---

```shell
set -ex
export TARGET=${{ matrix.target }}
export API=${{ env.ANDROID_API }}
export CC=$TOOLCHAIN/bin/${TARGET}${API}-clang
export CXX=$TOOLCHAIN/bin/${TARGET}${API}-clang++
export AR=$TOOLCHAIN/bin/llvm-ar
export LD=$TOOLCHAIN/bin/ld
export STRIP=$TOOLCHAIN/bin/llvm-strip
export CFLAGS="--sysroot=$TOOLCHAIN/sysroot"
export LDFLAGS="--sysroot=$TOOLCHAIN/sysroot"
BUILD_ROOT=$(pwd)/library-source
cd library-source

# Find the project root (where pyproject.toml or setup.py is)
PROJECT_FILE=$(find . -name "pyproject.toml" -o -name "setup.py" | head -n 1)
if [ -n "$PROJECT_FILE" ]; then
    PROJECT_DIR=$(dirname "$PROJECT_FILE")
    cd "$PROJECT_DIR"
fi

IS_MATURIN="false"
if [ -f "pyproject.toml" ] && grep -q 'build-backend.*=.*"maturin"' pyproject.toml; then
IS_MATURIN="true"
fi

if [ "$IS_MATURIN" = "true" ]; then
echo "Maturin build backend detected."
rustup target add ${{ matrix.target }}
TARGET_FOR_ENV=$(echo ${{ matrix.target }} | tr 'a-z-' 'A-Z_')
export CARGO_TARGET_${TARGET_FOR_ENV}_LINKER=${CC}
export CARGO_TARGET_${TARGET_FOR_ENV}_AR=${AR}
# Hints for PyO3 cross compilation so it doesn't try to use host libpython
export PYO3_CROSS=1
export PYO3_CROSS_PYTHON_VERSION=${{ env.PYTHON_VERSION }}
FEATURES=""
# Check if Cargo.toml has a direct dependency on pyo3 in the [dependencies] section
if [ -f "Cargo.toml" ] && grep -q '^pyo3 ' Cargo.toml; then
    echo "Direct pyo3 dependency found. Will enable 'extension-module' and attempt abi3 to avoid linking libpython."
    FEATURES="pyo3/extension-module"
fi

if [ -n "$FEATURES" ]; then
    # Try abi3 first (broad compatibility), then fall back if unsupported
    set +e
    export PYO3_NO_PYTHON=1
    maturin build --release --target ${{ matrix.target }} -i python${{ env.PYTHON_VERSION }} --features "$FEATURES pyo3/abi3-py37"
    BUILD_STATUS=$?
    set -e
    if [ $BUILD_STATUS -ne 0 ]; then
    echo "abi3 build failed, retrying without abi3..."
    unset PYO3_NO_PYTHON
    maturin build --release --target ${{ matrix.target }} -i python${{ env.PYTHON_VERSION }} --features "$FEATURES"
    fi
else
    maturin build --release --target ${{ matrix.target }} -i python${{ env.PYTHON_VERSION }}
fi
else
echo "Standard build backend detected."
python -m build --wheel
fi

# --- Normalization Step ---
# According to PEP 427, wheel names normalize hyphens to underscores.
NORMALIZED_LIB_NAME=$(echo "${{ env.LIBRARY_NAME }}" | tr '-' '_')
PLATFORM_ARCH=$(echo "${{ matrix.abi }}" | tr '-' '_')
echo "Normalized library name for search: ${NORMALIZED_LIB_NAME}"
echo "Normalized platform arch for wheel tag: ${PLATFORM_ARCH}"

# --- Find Wheel Step ---
SEARCH_PATH="dist"
if [ "$IS_MATURIN" = "true" ]; then
echo "Maturin build backend detected. Searching in target/wheels/"
SEARCH_PATH="target/wheels"
else
echo "Standard or no pyproject.toml build backend detected. Searching in dist/"
fi

WHEEL_PATH=$(find "${SEARCH_PATH}" -name "${NORMALIZED_LIB_NAME}-*.whl" | head -n 1)

if [ -z "${WHEEL_PATH}" ]; then
echo "::warning::Could not find wheel in '${SEARCH_PATH}'. Fallback to searching everywhere."
WHEEL_PATH=$(find . -name "${NORMALIZED_LIB_NAME}-*.whl" | head -n 1)
fi

if [ -z "${WHEEL_PATH}" ]; then
echo "::error::Failed to find wheel file anywhere for normalized name ${NORMALIZED_LIB_NAME}."
exit 1
fi

# --- Rename Wheel Step ---
# Extract Python/ABI tags from the built wheel to preserve abi3 when applicable
WHEEL_BASENAME=$(basename "${WHEEL_PATH}")
PY_FIELD=$(echo "${WHEEL_BASENAME}" | awk -F- '{print $3}')
ABI_FIELD=$(echo "${WHEEL_BASENAME}" | awk -F- '{print $4}')
if [ -z "${PY_FIELD}" ] || [ -z "${ABI_FIELD}" ]; then
# Fallback to cp tag from requested Python version
PY_FIELD="cp${PYTHON_VERSION//./}"
ABI_FIELD="${PY_FIELD}"
fi
VERSION_TO_USE=${LIBRARY_VERSION}
if [ -z "${VERSION_TO_USE}" ]; then
VERSION_TO_USE=$(basename "${WHEEL_PATH}" | cut -d- -f2)
echo "library-version not specified, using version from built wheel: ${VERSION_TO_USE}"
fi

NEW_WHEEL_NAME="${NORMALIZED_LIB_NAME}-${VERSION_TO_USE}-${PY_FIELD}-${ABI_FIELD}-android_${API}_${PLATFORM_ARCH}.whl"
echo "Original wheel: ${WHEEL_PATH}"
echo "New wheel name: ${NEW_WHEEL_NAME}"
mkdir -p $BUILD_ROOT/../output
mv "${WHEEL_PATH}" "$BUILD_ROOT/../output/${NEW_WHEEL_NAME}"
```